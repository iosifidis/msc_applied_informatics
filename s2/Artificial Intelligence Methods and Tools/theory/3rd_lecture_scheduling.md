## Σημειώσεις για τον Χρονοπρογραμματισμό στη Μοντελοποίηση Προβλημάτων

---

### **1. Εισαγωγή στον Χρονοπρογραμματισμό**
Ο χρονοπρογραμματισμός (scheduling) αφορά τη διαδικασία ανάθεσης πόρων σε εργασίες εντός ενός χρονικού διαστήματος, με βάση συγκεκριμένους περιορισμούς και ένα κριτήριο βελτιστοποίησης. Χρησιμοποιείται σε πολλούς τομείς, όπως η βιομηχανία, η λογιστική και η πληροφορική.

**Βασικά Στοιχεία:**
- **Εργασίες (Tasks/Jobs):** Μονάδες εργασίας που πρέπει να εκτελεστούν. Έχουν διάρκεια, απαιτήσεις σε πόρους και χρονικά όρια.   
- **Πόροι (Resources):** Στοιχεία που απαιτούνται για την εκτέλεση εργασιών (π.χ. μηχανήματα, υπάλληλοι). Μπορεί να είναι επαναχρησιμοποιήσιμοι (reusable) ή καταναλωσιμοί (consumable).   
- **Απαιτήσεις σε Πόρους (r):** Καθορίζουν ποιους πόρους και σε ποια ποσότητα χρειάζεται μια εργασία.   
- **Χρονικά Όρια:**
   - **Χρόνος Έναρξης (Start Time) (s):** Η στιγμή που μια εργασία ξεκινά. Εντός ενός διαστήματος [est, lst].   
   - **Χρόνος Λήξης (End Time) (c):** Η στιγμή που μια εργασία ολοκληρώνεται. Εντός ενός διαστήματος [ect, lct].   
   - **Διάρκεια (Duration) (d):** Ο χρόνος που απαιτείται για την ολοκλήρωση μιας εργασίας. Μπορεί να εξαρτάται από τον πόρο (processing time pij).   
- **Βάρος (w):** Δηλώνει τη σημασία μιας εργασίας σε σχέση με άλλες.   
- **Περιορισμοί (Constraints):** Κανόνες που περιορίζουν τις αναθέσεις εργασιών (π.χ., κάποιες εργασίες πρέπει να εκτελεστούν πριν από άλλες).  
- **Στόχος:** Ελαχιστοποίηση ή μεγιστοποίηση ενός μεγέθους (π.χ., συνολικού χρόνου, κόστους).

---

### **2. Χαρακτηριστικά Εργασιών**
**Είδη Εργασιών:**
- **Μη προεκτοπιστικές (non-preemptive):** Δεν διακόπτονται (di= ci - si).
- **Προεκτοπιστικές (preemptive):** Μπορούν να διακοπούν και να επανεκκινήσουν (di = Σ(dki) ≤ ci - si | k in I}).
- **Ελαστικές (elastic):** Η διάρκεια και οι απαιτήσεις σε πόρους μπορούν να αλλάξουν, με σταθερό γινόμενο (Ei = di * ri).

---

### **3. Τύποι Πόρων**
- **Επαναχρησιμοποιήσιμοι (reusable):** Δεσμεύονται προσωρινά και ελευθερώνονται μετά τη χρήση (π.χ., μηχανές).
- **Καταναλωσιμοί (consumable):** Καταναλώνονται ή παράγονται κατά την εκτέλεση της εργασίας (π.χ., πρώτες ύλες). Μετά το πέρας της εργασίας το τρέχον επίπεδο του πόρου δεν επανέρχεται στην αρχική τιμή του

---

### **4. Τύποι Προβλημάτων Χρονοπρογραμματισμού**
#### **4.1. Αποκλειστικός Χρονοπρογραμματισμός (Disjunctive Scheduling)**
- Κάθε πόρος μπορεί να εκτελεί μία μόνο εργασία κάθε στιγμή. Χρησιμοποιείται όταν η χωρητικότητα των πόρων είναι 1.   
- Χρήση για προβλήματα όπου πόροι είναι **μη διαμοιράσιμοι** (π.χ., ένα μηχάνημα μπορεί να εκτελεί μόνο μία εργασία κάθε φορά).   
- **Παράδειγμα:** Σε μια γραμμή παραγωγής, μια μηχανή μπορεί να επεξεργαστεί ένα μόνο αντικείμενο κάθε δεδομένη χρονική στιγμή.   
- Δύο εργασίες που απαιτούν τον ίδιο πόρο δεν μπορούν να αλληλεπικαλύπτονται:  
  c1 ≤ s2 \/ c2 ≤ s1

#### **4.2. Σωρευτικός Χρονοπρογραμματισμός (Cumulative Scheduling)**
- Κάθε πόρος έχει **πεπερασμένη χωρητικότητα** και μπορεί να χρησιμοποιηθεί από πολλές εργασίες ταυτόχρονα.
- Χρήσιμο για περιβάλλοντα όπου οι πόροι μπορούν να κατανεμηθούν μερικώς σε διαφορετικές εργασίες.
- **Παράδειγμα:** Σε μια αποθήκη με **περιορισμένη χωρητικότητα**, πολλά προϊόντα μπορούν να αποθηκευτούν ταυτόχρονα, αλλά υπάρχει ένα όριο στη συνολική ποσότητα.
- Χρησιμοποιείται όταν η χωρητικότητα των πόρων είναι > 1. Το άθροισμα των πόρων που καταναλώνονται σε κάθε χρονική στιγμή δεν πρέπει να ξεπερνά τη χωρητικότητα:  

**Περιορισμοί στη MiniZinc:**
- `disjunctive(StartTimes, Durations)`: Εξασφαλίζει ότι οι εργασίες δεν αλληλεπικαλύπτονται.
- `cumulative(StartTimes, Durations, Resources, ResourceLimit)`: Ελέγχει τη συνολική χρήση πόρων.

---

### Περιορισμοί
#### Χρονικά όρια
- **χρόνος ανακοίνωσης** (ri release date): η εργασία δεν μπορεί να ξεκινήσει πριν από αυτό το όριο.   
- **χρόνος παράδοσης** (due date δi): εργασία μπορεί να παραδοθεί μετά τον παραπάνω χρόνο με κάποια ποινή.   

#### Περιορισμοί διάταξης
- μια εργασία πρέπει να λάβει χώρα πριν από μια άλλη

#### Περιορισμοί καταλληλότητας πόρων
- χρόνοι αρχικοποίησης (setup) πόρων ανάμεσα σε δύο εργασίες   
- εναλλακτικοί πόροι

---

### **5. Συναρτήσεις Βελτιστοποίησης**
Ελαχιστοποίηση των ακόλουθων μεγεθών (ci δηλώνει το χρόνο ολοκλήρωσης- completion time δi χρόνο παράδοσης -due date, deadline)

- **Makespan:** Χρόνος ολοκλήρωσης:  
    max(c1, c2, ... , cn)   
- **Τotal weighted completion time:** Σταθμισμένο Άθροισμα χρόνων ολοκλήρωσης:   
    sum(wi * ci)   
- **Lateness:** Μέγιστη Αργοπορία (μπορεί να πάρει και αρνητικές τιμές) (li = ci - δi):  
    max(c1 - δ1, ..., ci - δi)   
- **Tardiness:** Μέγιστη Καθυστέρηση (τi = max(0, ci - δi)):   
    max(0, ci - δi)   
- **Τotal weighted completion time:** Σταθμισμένο Άθροισμα καθυστέρησης:   
    sum(wi * τi)

---

### **6. Μοντελοποίηση σε MiniZinc**

#### Αναπαράσταση Χρόνου
Για κάθε εργασία Ai, ορίζονται οι αντίστοιχες μεταβλητές, και ο περιορισμός  (χρόνος έναρξης + διάρκεια = χρόνος λήξης):
```minizinc
%% Ordering Constraints
order = [|1,2|3,5|7,8|];
constraint forall(o in ORDERS)
     (end[order[o,1]] <= start[order[o,2]] );
```

- Περιορισμοί διάταξης (μερικής) μεταξύ των εργασιών.
```minizinc
%% Ordering Constraints
order = [|1,2|3,5|7,8|];
constraint forall(o in ORDERS)
    (end[order[o,1]] <= start[order[o,2]] );
```

- **Παράδειγμα Disjunctive Scheduling:**
Θέτει τον περιορισμό ότι οι διεργασίες με αρχικούς χρόνους StartTimes και διάρκειες Durations δεν μπορούν να αλληλεπικαλύπτονται χρονικά.
```minizinc
include "globals.mzn";
constraint disjunctive([start[i] | i in machineA], [duration[i] | i in machineA]);
constraint disjunctive([start[i] | i in machineB], [duration[i] | i in machineB]);
solve minimize max(end);
```

#### Μηχανές με Χωρητικότητα
- Κάθε μηχανή έχει συγκεκριμένη χωρητικότητα (capacity)
```minizinc
array[MACHINES] of int: capacity = [7,8];
```

- Κάθε εργασία απαιτεί συγκεκριμένη χωρητικότητα (resource) από την μηχανή.
```minizinc
array[JOBS] of int: resource;
resource = [3,4,2,5,1,2,3,3];
```

- Περιορισμός Πόρων
Για κάθε σύνολο εργασιών Α που συμμετέχει σε ένα πόρο με χωρητικότητα Cap, r(Ai,t) η απαιτούμενη χωρητικότητα σε πόρους της εργασίας Ai, την χρονική στιγμή t, και min(startA), o μικρότερος χρόνος έναρξης μιας εργασίας Αi στο Α, και max(endA), o μεγαλύτερος χρόνος λήξης μιας εργασίας Αj στο A, πρέπει να ισχύει:

`για κάθε t ∈[min(startA) , max (endA)]: Σ r(Ai , t) ⩽= cap`

- **Παράδειγμα Cumulative Scheduling:**
```minizinc
constraint cumulative(
    [start[i] | i in allocated_to[m]],
    [duration[i] | i in allocated_to[m]],
    [resource[i] | i in allocated_to[m]],
    capacity[m]
);
```

---

### **7. Τεχνικές Διάδοσης Περιορισμών**
- **Edge Finding:**  
  Αναγνωρίζει εργασίες που πρέπει να εκτελεστούν πριν ή μετά από άλλες, με βάση τη χωρητικότητα των πόρων.  
  \[ \text{let}_\Omega - \text{est}_\Omega < d_\Omega \implies \text{Ασυνέπεια} \]

- **TimeTable Algorithm:**  
  Χρησιμοποιεί τα "compulsory parts" των εργασιών για να ελέγξει τη χρήση πόρων και να ενημερώσει τα χρονικά πεδία.

- **Sweep Algorithm:**  
  Διατρέχει τα χρονικά σημεία ενδιαφέροντος για να ενημερώσει τα `est` και `let` των εργασιών.

---

### **8. Συμπεράσματα**
- Ο χρονοπρογραμματισμός είναι ένα ισχυρό εργαλείο για τη βελτιστοποίηση της χρήσης πόρων.
- Η επιλογή μεταξύ disjunctive και cumulative scheduling εξαρτάται από τη χωρητικότητα των πόρων.
- Οι τεχνικές διάδοσης περιορισμών (όπως edge finding) βελτιώνουν την αποδοτικότητα της επίλυσης.

---

### **9. Πρακτικές Συμβουλές**
- **Επαλήθευση Δεδομένων:** Βεβαιωθείτε ότι οι πίνακες durations και resources είναι συνεπείς.
- **Αποσφαλμάτωση:** Χρησιμοποιήστε ενδιάμεσες εκτυπώσεις για να ελέγξετε τις τιμές των μεταβλητών.
- **Βελτιστοποίηση:** Εξετάστε τη χρήση redundant constraints για να επιταχύνετε τη διαδικασία επίλυσης.
