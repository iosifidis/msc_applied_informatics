# **Χωρικές Βάσεις Δεδομένων (Spatial Databases)**

## **1. Τι είναι μια Spatial Database; (Διαφάνεια 2)**

*   Μια Spatial Database (Χωρική Βάση Δεδομένων) είναι μια βάση δεδομένων που μπορεί να **αποθηκεύσει και να διαχειριστεί χωρικά αντικείμενα (spatial objects)**, εκτός από τα κλασικά (αριθμοί, κείμενα, ημερομηνίες κλπ.).
*   Αυτές οι βάσεις έχουν **επιπλέον χαρακτηριστικά** σε σχέση με μια απλή βάση δεδομένων:
    *   Υποστήριξη **Χωρικών Τύπων Δεδομένων (Spatial Data Types)**, όπως σημείο (point), γραμμή (line), πολύγωνο (polygon). Αυτοί οι τύποι δεδομένων επιτρέπουν στη βάση να "κατανοήσει" τη γεωμετρία των αντικειμένων.
    *   Υποστήριξη **Πολυδιάστατης Χωρικής Ευρετηρίασης (Multidimensional Spatial Indexing)**. Δεδομένου ότι τα χωρικά αντικείμενα έχουν 2 ή 3 διαστάσεις (συντεταγμένες x, y, και ενδεχομένως z) και συχνά επικαλύπτονται ή περιέχονται το ένα στο άλλο, τα κλασικά μονοδιάστατα ευρετήρια (όπως τα B+trees που χρησιμοποιούνται για αριθμούς ή κείμενο) δεν είναι αποδοτικά. Χρειάζονται ειδικά **χωρικά ευρετήρια** όπως τα **R-trees** για γρήγορη αναζήτηση αντικειμένων σε μια συγκεκριμένη περιοχή (bounding box).
    *   Υποστήριξη **Χωρικών Συναρτήσεων (Spatial Functions)** σε SQL. Αυτές είναι ειδικές λειτουργίες που εκτελούν υπολογισμούς ή αναλύσεις πάνω σε χωρικά δεδομένα (π.χ. υπολογισμός απόστασης, εμβαδού, ελέγχου επικάλυψης).

## **2. Γεωμετρικοί Τύποι (Geometry Types) (Διαφάνεια 4, 7, 15)**

Οι χωρικές βάσεις δεδομένων υποστηρίζουν ιεραρχία τύπων δεδομένων γεωμετρίας (Geometry Hierarchy, Διαφάνεια 4). Οι βασικοί τύποι, που είδαμε και στα GIS:

*   **Point:** Ένα μοναδικό σημείο με συντεταγμένες. (Διαφάνεια 7, 15).
*   **LineString:** Μια σειρά από συνδεδεμένα σημεία που σχηματίζουν μια γραμμή. (Διαφάνεια 7, 15).
*   **Polygon:** Μια σειρά από συνδεδεμένα σημεία που σχηματίζουν κλειστή περιοχή. (Διαφάνεια 7, 15).
*   Επίσης, υποστηρίζονται συλλογές (collections) αυτών, όπως MultiPoint, MultiLineString, MultiPolygon (για αντικείμενα που αποτελούνται από περισσότερα του ενός μέρη του ίδιου τύπου γεωμετρίας), Curve, Surface (για πιο σύνθετες μορφές).

## **3. Χωρικά Ευρετήρια (Spatial Indexes) (Διαφάνεια 5, 6)**

*   Όπως αναφέρθηκε, για την αποδοτική αναζήτηση σε πολυδιάστατα χωρικά δεδομένα που μπορεί να επικαλύπτονται, χρειάζονται ειδικά ευρετήρια.
*   **R-trees:** Ένας δημοφιλής τύπος χωρικού ευρετηρίου. Βασική ιδέα: κάθε κόμβος στο δέντρο αντιπροσωπεύει ένα **Minimum Bounding Rectangle (MBR)** ή **Bounding Box (BBox)**, δηλαδή το μικρότερο ορθογώνιο, παράλληλο προς τους άξονες συντεταγμένων, που περιέχει όλα τα χωρικά αντικείμενα στα "παιδιά" του κόμβου.
*   **Λειτουργία R-trees:** Όταν ψάχνεις αντικείμενα σε μια περιοχή (Bounding Box), το ευρετήριο σε οδηγεί γρήγορα στους κόμβους/Bounding Boxes που επικαλύπτονται με την περιοχή αναζήτησης.
*   **Πλεονέκτημα MBR:** Μας δίνει **κατά προσέγγιση αποτελέσματα (approximate results)** - ένα αντικείμενο μπορεί να έχει MBR που επικαλύπτεται με την περιοχή αναζήτησης, αλλά το ίδιο το αντικείμενο να μην βρίσκεται τελικά εντός. Ωστόσο, αυτή η "κατά προσέγγιση" αναζήτηση είναι πολύ **ταχύτερη** από τη σάρωση όλων των αντικειμένων, και μετά γίνεται ο ακριβής έλεγχος μόνο στα υποψήφια αντικείμενα (filter and refine).

## **4. Χωρικές Συναρτήσεις (Spatial Functions) (Διαφάνεια 8)**

Οι Spatial Databases ορίζουν μια σειρά από ειδικές συναρτήσεις που εκτελούνται σε SQL και επιτρέπουν χωρικές αναλύσεις και υπολογισμούς. Οργανώνονται σε κατηγορίες (όπως ορίζονται στο standard OGC SFSQL):

*   **Conversion (Μετατροπή):** Συναρτήσεις για μετατροπή μεταξύ διαφόρων αναπαραστάσεων γεωμετρίας (π.χ. από WKT - Well-Known Text σε binary format).
*   **Management (Διαχείριση):** Συναρτήσεις για διαχείριση πληροφορίας σχετικής με χωρικούς πίνακες/γεωμετρίες (π.χ. ανάκτηση χωρικού συστήματος αναφοράς).
*   **Retrieval (Ανάκτηση):** Συναρτήσεις για ανάκτηση ιδιοτήτων ή μετρήσεις γεωμετριών (π.χ. μήκος μιας γραμμής, εμβαδόν ενός πολυγώνου).
*   **Comparison (Σύγκριση):** Συναρτήσεις για σύγκριση γεωμετριών σε σχέση με τη **χωρική συσχέτισή τους (spatial relationship)**. Πολύ σημαντική κατηγορία. (Βλ. παρακάτω).
*   **Generation (Παραγωγή):** Συναρτήσεις για δημιουργία νέων γεωμετριών από άλλες (π.χ. υπολογισμός buffer zone γύρω από ένα αντικείμενο, υπολογισμός τομής δύο πολυγώνων).

## **5. Χωρικές Συσχετίσεις (Spatial Relationships) (Διαφάνειες 9-16)**

Οι συναρτήσεις σύγκρισης μας επιτρέπουν να απαντήσουμε ερωτήματα όπως:

*   `ST_Equals(geom1, geom2)`: Είναι δύο γεωμετρίες χωρικά ίσες; (Διαφάνεια 9).
*   `ST_Intersects(geom1, geom2)`: Επικαλύπτονται ή διασταυρώνονται δύο γεωμετρίες; (Διαφάνεια 10).
*   `ST_Disjoint(geom1, geom2)`: Έχουν δύο γεωμετρίες καμία επαφή (ούτε καν σε όρια); (Διαφάνεια 11).
*   `ST_Crosses(geom1, geom2)`: Διασταυρώνονται δύο γεωμετρίες (τυπικά γραμμές); (Διαφάνεια 12).
*   `ST_Overlaps(geom1, geom2)`: Επικαλύπτονται δύο γεωμετρίες του ίδιου τύπου, με την τομή να είναι ίδιου τύπου αλλά όχι ίσες; (Διαφάνεια 13).
*   `ST_Touches(geom1, geom2)`: Έχουν δύο γεωμετρίες κοινό σημείο/τμήμα μόνο στα όριά τους; (Διαφάνεια 14).
*   `ST_Within(geom1, geom2)` ή `ST_Contains(geom2, geom1)`: Βρίσκεται η geom1 *μέσα* στη geom2; (Διαφάνεια 15).
*   `ST_DWithin(geom1, geom2, distance)`: Βρίσκονται δύο γεωμετρίες **σε απόσταση μικρότερη ή ίση** από ένα δεδομένο distance; (Διαφάνεια 16). Αυτή η συνάρτηση είναι εξαιρετικά χρήσιμη για spatial range queries, εκμεταλλευόμενη τα χωρικά ευρετήρια.

## **6. Γενιές Αρχιτεκτονικών GIS (Εξέλιξη) (Διαφάνεια 3)**

Η υποστήριξη χωρικών δεδομένων έχει εξελιχθεί στις αρχιτεκτονικές βάσεων δεδομένων:

*   **First-Generation GIS:** Τα δεδομένα (γεωμετρία και χαρακτηριστικά - attributes) αποθηκεύονται σε **αρχεία στο file system**. Τα GIS tools έχουν ιδιόκτητα API για πρόσβαση σε αυτά τα αρχεία.
*   **Second-Generation GIS:** Τα χαρακτηριστικά (attributes) αποθηκεύονται σε **πίνακες RDBMS**, ενώ η γεωμετρία μπορεί να αποθηκεύεται σε αρχεία ή σε BLOBs (Binary Large Objects) εντός του RDBMS. Χρησιμοποιείται SQL για πρόσβαση στα attributes.
*   **Third-Generation GIS (Spatial Databases):** Η **γεωμετρία** αποθηκεύεται **μαζί με τα χαρακτηριστικά** σε **πίνακες RDBMS** χρησιμοποιώντας ειδικούς χωρικούς τύπους δεδομένων (όπως ADTs - Abstract Data Types). Η πρόσβαση γίνεται εξ ολοκλήρου μέσω **SQL**, εμπλουτισμένης με χωρικές συναρτήσεις. Αυτή είναι η αρχιτεκτονική των σύγχρονων Spatial Databases όπως το PostGIS.

## **7. Χωρικές ΒΔ Ανοικτού Κώδικα (Open Source Spatial Databases) (Διαφάνεια 17)**

Στο χώρο των χωρικών βάσεων δεδομένων, υπάρχουν ισχυρά εργαλεία ανοικτού κώδικα που χρησιμοποιούνται ευρέως:

*   **Server-Side:**
    *   **PostGIS:** Είναι μια **επέκταση της βάσης δεδομένων PostgreSQL** που προσθέτει χωρικές δυνατότητες. Θεωρείται de facto standard για τις χωρικές βάσεις δεδομένων ανοικτού κώδικα, προσφέροντας πλήρη υποστήριξη για χωρικούς τύπους, ευρετήρια και συναρτήσεις. Αποτελεί τη βάση του workshop από το οποίο προέρχονται αυτές οι διαφάνειες.
        *   Επίσημη σελίδα: http://postgis.net/
        *   Tutorial: https://postgis.net/workshops/postgis-intro/
*   **Desktop / Embedded:**
    *   **SpatiaLite:** Είναι μια **χωρική επέκταση της βάσης δεδομένων SQLite**. Προσφέρει ένα ελαφρύ και φορητό περιβάλλον για τη διαχείριση χωρικών δεδομένων, ιδανικό για desktop εφαρμογές ή μικρότερης κλίμακας projects.
        *   Επίσημη σελίδα: https://www.gaia-gis.it/fossil/libspatialite/index
        *   How-to για αρχάριους: http://www.gaia-gis.it/gaia-sins/spatialite-cookbook/index.html
    *   **NYC Geodatabase (tutorial):** Ένα παράδειγμα tutorial που δείχνει τη χρήση χωρικών δεδομένων (ενδεχομένως με SpatiaLite, MS Access/ArcGIS) για τη διαχείριση γεωδεδομένων πόλεων.
        *   Tutorial: https://www.baruch.cuny.edu/confluence/display/geoportal/NYC+Geodatabase

## **Σύνδεση με το μάθημα:**

Η ύπαρξη των Spatial Databases, όπως το PostGIS, μας δείχνει πώς τα παραδοσιακά μοντέλα βάσεων δεδομένων (RDBMS στην περίπτωση αυτή) έχουν **επεκταθεί** για να διαχειριστούν αποτελεσματικά ένα ειδικό είδος δεδομένων (χωρικά δεδομένα) που είναι κρίσιμο για Big Data και Cloud εφαρμογές.

*   Αντί να φτιάξουμε ένα εντελώς νέο NoSQL σύστημα, εδώ εμπλουτίσαμε ένα υπάρχον, ώριμο σύστημα (PostgreSQL) με τις απαραίτητες χωρικές δυνατότητες.
*   Αυτό μας επιτρέπει να χρησιμοποιήσουμε την ισχύ και την ευελιξία της SQL για ερωτήματα που συνδυάζουν κλασικά χαρακτηριστικά με χωρικές σχέσεις (π.χ. "βρες όλα τα καταστήματα (σημεία) που βρίσκονται εντός αυτής της περιοχής πωλήσεων (πολύγωνο) και τα οποία είχαν πωλήσεις πάνω από X το περσινό τρίμηνο").

Αν και ορισμένα συστήματα NoSQL (όπως το MongoDB) προσφέρουν βασικές γεω-χωρικές (geo-spatial) δυνατότητες, οι Spatial Databases τύπου PostGIS προσφέρουν πολύ πιο πλήρες και ισχυρό σύνολο χαρακτηριστικών και συναρτήσεων για σύνθετη χωρική ανάλυση.


