# Προβλήματα για την Cassandra.

Για όλα τα προβλήματα, υποθέτουμε ότι η αρχική κατάσταση περιλαμβάνει όλα τα κόμβα ενεργά εκτός αν αναφέρεται ρητά κάποια αποτυχία. Επίσης, η ανάγνωση ζητείται από έναν *ενεργό* κόμβο στο αναφερόμενο κέντρο δεδομένων.

---

### **Πρόβλημα 1**

**Διαμόρφωση:** Έχουμε ένα Cassandra cluster με δύο datacenters (DC1 και DC2). Το DC1 έχει 4 κόμβους και το DC2 έχει 3 κόμβους. Ο συντελεστής αναπαραγωγής (Replication Factor - RF) έχει οριστεί σε 3 για το DC1 και 2 για το DC2.

**Κατάσταση:** Ένας κόμβος έχει αποτύχει στο DC1 και ένας κόμβος έχει αποτύχει στο DC2.

**Ερωτήσεις:**   
a) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **LOCAL_ONE** σε έναν ενεργό κόμβο στο DC1;   
b) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **LOCAL_QUORUM** σε έναν ενεργό κόμβο στο DC2;   
c) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **EACH_QUORUM** σε έναν ενεργό κόμβο στο DC1;   

---

**Λύση 1:**

**Αρχική Κατάσταση:**
*   DC1: 4 κόμβοι. RF = 3.   
*   DC2: 3 κόμβοι. RF = 2.   
*   Αποτυχίες: 1 κόμβος στο DC1, 1 κόμβος στο DC2.   

**Ενεργοί Κόμβοι μετά τις αποτυχίες:**
*   DC1: 4 - 1 = 3 ενεργοί κόμβοι.   
*   DC2: 3 - 1 = 2 ενεργοί κόμβοι.   

**Απαντήσεις:**   
a) **LOCAL_ONE σε ενεργό κόμβο στο DC1:**   
    *   Απαιτείται: 1 επιτυχής απάντηση από το τοπικό datacenter.   
    *   Διαθέσιμοι: 3 ενεργοί κόμβοι στο DC1.   
    *   Αποτέλεσμα: **Επιτυχία**. Υπάρχει τουλάχιστον ένας ενεργός κόμβος στο DC1 για να απαντήσει.   

b) **LOCAL_QUORUM σε ενεργό κόμβο στο DC2:**   
    *   Απαιτείται: Πλειοψηφία των ρεπλικών στο τοπικό datacenter (RF DC2 = 2). Πλειοψηφία = (2 / 2) + 1 = 2 επιτυχείς απαντήσεις από το DC2.   
    *   Διαθέσιμοι: 2 ενεργοί κόμβοι στο DC2.   
    *   Αποτέλεσμα: **Επιτυχία**. Υπάρχουν ακριβώς 2 ενεργοί κόμβοι στο DC2, οπότε η απαίτηση για πλειοψηφία ικανοποιείται.   

c) **EACH_QUORUM σε ενεργό κόμβο στο DC1:**   
    *   Απαιτείται: Πλειοψηφία των ρεπλικών σε ΚΑΘΕ datacenter όπου βρίσκονται τα ρεπλίκες του δεδομένου.   
        *   Για DC1 (RF=3): Πλειοψηφία = (3 / 2) + 1 = 2 επιτυχείς απαντήσεις. Διαθέσιμοι 3 κόμβοι στο DC1. **OK**.   
        *   Για DC2 (RF=2): Πλειοψηφία = (2 / 2) + 1 = 2 επιτυχείς απαντήσεις. Διαθέσιμοι 2 κόμβοι στο DC2. **OK**.   
    *   Αποτέλεσμα: **Επιτυχία**. Και τα δύο datacenters μπορούν να ικανοποιήσουν την απαίτηση του τοπικού QUORUM.   

---

### **Πρόβλημα 2**

**Διαμόρφωση:** Ένα Cassandra cluster με 3 datacenters (DC1, DC2, DC3). Κάθε datacenter έχει 3 κόμβους. Ο συντελεστής αναπαραγωγής (RF) είναι 2 για κάθε datacenter.

**Κατάσταση:** Έχουν αποτύχει όλοι οι κόμβοι στο DC1. Οι υπόλοιποι κόμβοι είναι ενεργοί.

**Ερωτήσεις:**   
a) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **QUORUM** σε έναν ενεργό κόμβο στο DC2;   
b) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **EACH_QUORUM** σε έναν ενεργό κόμβο στο DC3;   
c) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **LOCAL_ONE** σε έναν ενεργό κόμβο στο DC2;   

---

**Λύση 2:**

**Αρχική Κατάσταση:**
*   DC1: 3 κόμβοι. RF = 2.
*   DC2: 3 κόμβοι. RF = 2.
*   DC3: 3 κόμβοι. RF = 2.
*   Αποτυχίες: Όλοι οι 3 κόμβοι στο DC1 έχουν αποτύχει.

**Ενεργοί Κόμβοι μετά τις αποτυχίες:**
*   DC1: 0 ενεργοί κόμβοι.
*   DC2: 3 ενεργοί κόμβοι.
*   DC3: 3 ενεργοί κόμβοι.

**Απαντήσεις:**   
a) **QUORUM σε ενεργό κόμβο στο DC2:**   
    *   Απαιτείται: Πλειοψηφία του συνόλου των ρεπλικών του cluster. Το συνολικό RF για ένα δεδομένο είναι RF(DC1) + RF(DC2) + RF(DC3) = 2 + 2 + 2 = 6.   
    *   Πλειοψηφία = (6 / 2) + 1 = 4 επιτυχείς απαντήσεις.   
    *   Διαθέσιμοι: 0 (DC1) + 3 (DC2) + 3 (DC3) = 6 ενεργοί ρεπλίκες συνολικά (εάν υποθέσουμε ότι οι αποτυχίες είναι κομβικές και όχι απώλεια ολόκληρου του datacenter από άποψη επικοινωνίας). Αν υποτεθεί ότι το RF αναφέρεται στον αριθμό των ρεπλικών του δεδομένου στο cluster, τότε απαιτούνται 4 ενεργά ρεπλίκες.   
    *   Σε αυτή την περίπτωση, έχουμε 3 ενεργά ρεπλίκες στο DC2 και 3 στο DC3, άρα συνολικά 6 διαθέσιμα (σε διαφορετικά datacenters) που είναι περισσότερα από 4.   
    *   Αποτέλεσμα: **Επιτυχία**. Παρά την απώλεια ενός DC, υπάρχουν αρκετά ρεπλίκες σε άλλα DC για να επιτευχθεί το συνολικό QUORUM.   

b) **EACH_QUORUM σε ενεργό κόμβο στο DC3:**   
    *   Απαιτείται: Πλειοψηφία των ρεπλικών σε ΚΑΘΕ datacenter.   
        *   Για DC1 (RF=2): Πλειοψηφία = (2 / 2) + 1 = 2 επιτυχείς απαντήσεις. Διαθέσιμοι: 0 κόμβοι στο DC1. **ΑΠΟΤΥΧΙΑ**.   
    *   Αποτέλεσμα: **Αποτυχία**. Το DC1 δεν μπορεί να ικανοποιήσει την απαίτηση του τοπικού QUORUM, οπότε το EACH_QUORUM αποτυγχάνει συνολικά.   

c) **LOCAL_ONE σε ενεργό κόμβο στο DC2:**   
    *   Απαιτείται: 1 επιτυχής απάντηση από το τοπικό datacenter.   
    *   Διαθέσιμοι: 3 ενεργοί κόμβοι στο DC2.   
    *   Αποτέλεσμα: **Επιτυχία**. Υπάρχει τουλάχιστον ένας ενεργός κόμβος στο DC2 για να απαντήσει.   

---

### **Πρόβλημα 3**

**Διαμόρφωση:** Ένα Cassandra cluster με 2 datacenters (DC1, DC2). Το DC1 έχει 5 κόμβους και το DC2 έχει 1 κόμβο. Ο συντελεστής αναπαραγωγής (RF) είναι 3 για το DC1 και 1 για το DC2.

**Κατάσταση:** Έχουν αποτύχει 2 κόμβοι στο DC1. Ο κόμβος του DC2 είναι ενεργός.

**Ερωτήσεις:**   
a) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **LOCAL_QUORUM** σε έναν ενεργό κόμβο στο DC1;   
b) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **ALL** σε έναν ενεργό κόμβο στο DC2;   
c) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **ONE** σε έναν ενεργό κόμβο στο DC1;   

---

**Λύση 3:**

**Αρχική Κατάσταση:**
*   DC1: 5 κόμβοι. RF = 3.
*   DC2: 1 κόμβος. RF = 1.
*   Αποτυχίες: 2 κόμβοι στο DC1.

**Ενεργοί Κόμβοι μετά τις αποτυχίες:**
*   DC1: 5 - 2 = 3 ενεργοί κόμβοι.
*   DC2: 1 ενεργός κόμβος.

**Απαντήσεις:**   
a) **LOCAL_QUORUM σε ενεργό κόμβο στο DC1:**   
    *   Απαιτείται: Πλειοψηφία των ρεπλικών στο τοπικό datacenter (RF DC1 = 3). Πλειοψηφία = (3 / 2) + 1 = 2 επιτυχείς απαντήσεις από το DC1.   
    *   Διαθέσιμοι: 3 ενεργοί κόμβοι στο DC1.   
    *   Αποτέλεσμα: **Επιτυχία**. Υπάρχουν αρκετοί ενεργοί κόμβοι στο DC1 (3 > 2) για να ικανοποιήσουν την απαίτηση.   

b) **ALL σε ενεργό κόμβο στο DC2:**   
    *   Απαιτείται: Απάντηση από ΟΛΑ τα ρεπλίκες του δεδομένου. Το δεδομένο έχει 3 ρεπλίκες στο DC1 και 1 στο DC2. Συνολικά 4 ρεπλίκες.   
    *   Αυτά τα ρεπλίκες πρέπει να απαντήσουν όλα. Αυτό σημαίνει 3 ενεργοί στο DC1 (RF=3) και 1 ενεργός στο DC2 (RF=1).   
    *   Διαθέσιμοι: DC1 έχει 3 ενεργούς (RF=3). DC2 έχει 1 ενεργό (RF=1).   
    *   Αποτέλεσμα: **Επιτυχία**. Όλοι οι κόμβοι που κατέχουν ένα ρεπλίκα για το δεδομένο είναι ενεργοί και μπορούν να απαντήσουν.   

c) **ONE σε ενεργό κόμβο στο DC1:**   
    *   Απαιτείται: Τουλάχιστον 1 επιτυχής απάντηση από οποιοδήποτε ρεπλίκα του δεδομένου.   
    *   Διαθέσιμοι: Υπάρχουν ενεργοί κόμβοι τόσο στο DC1 (3) όσο και στο DC2 (1) που διαθέτουν ρεπλίκες.   
    *   Αποτέλεσμα: **Επιτυχία**. Η απαίτηση ικανοποιείται εύκολα.   

---

### **Πρόβλημα 4**

**Διαμόρφωση:** Ένα Cassandra cluster με ένα datacenter (DC1). Το DC1 έχει 5 κόμβους. Ο συντελεστής αναπαραγωγής (RF) είναι 3.

**Κατάσταση:** Έχουν αποτύχει 3 κόμβοι στο DC1.

**Ερωτήσεις:**   
a) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **ONE** σε έναν ενεργό κόμβο στο DC1;   
b) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **LOCAL_QUORUM** σε έναν ενεργό κόμβο στο DC1;   
c) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **ALL** σε έναν ενεργό κόμβο στο DC1;   

---

**Λύση 4:**

**Αρχική Κατάσταση:**
*   DC1: 5 κόμβοι. RF = 3.
*   Αποτυχίες: 3 κόμβοι στο DC1.

**Ενεργοί Κόμβοι μετά τις αποτυχίες:**
*   DC1: 5 - 3 = 2 ενεργοί κόμβοι.

**Απαντήσεις:**   
a) **ONE σε ενεργό κόμβο στο DC1:**   
    *   Απαιτείται: 1 επιτυχής απάντηση.   
    *   Διαθέσιμοι: 2 ενεργοί κόμβοι στο DC1.   
    *   Αποτέλεσμα: **Επιτυχία**. Υπάρχουν αρκετοί ενεργοί κόμβοι για να ανταποκριθούν.   

b) **LOCAL_QUORUM σε ενεργό κόμβο στο DC1:**   
    *   Απαιτείται: Πλειοψηφία των ρεπλικών στο τοπικό datacenter (RF DC1 = 3). Πλειοψηγία = (3 / 2) + 1 = 2 επιτυχείς απαντήσεις από το DC1.   
    *   Διαθέσιμοι: 2 ενεργοί κόμβοι στο DC1.   
    *   Αποτέλεσμα: **Επιτυχία**. Υπάρχουν ακριβώς 2 ενεργοί κόμβοι στο DC1, οπότε η απαίτηση ικανοποιείται.   

c) **ALL σε ενεργό κόμβο στο DC1:**   
    *   Απαιτείται: Απάντηση από ΟΛΑ τα ρεπλίκες του δεδομένου (RF = 3). Αυτό σημαίνει ότι και οι 3 κόμβοι που κατέχουν ένα ρεπλίκα πρέπει να απαντήσουν.   
    *   Διαθέσιμοι: 2 ενεργοί κόμβοι στο DC1.   
    *   Αποτέλεσμα: **Αποτυχία**. Ενώ το RF είναι 3, μόνο 2 κόμβοι είναι ενεργοί. Ο ένας από τους 3 κόμβους που περιέχει το ρεπλίκα έχει αποτύχει, οπότε η απαίτηση για "όλους" δεν ικανοποιείται.   

---

### **Πρόβλημα 5**

**Διαμόρφωση:** Ένα Cassandra cluster με δύο datacenters (DC1 και DC2). Το DC1 έχει 2 κόμβους και το DC2 έχει 2 κόμβους. Ο συντελεστής αναπαραγωγής (RF) έχει οριστεί σε 2 για το DC1 και 2 για το DC2.

**Κατάσταση:** Ένας κόμβος έχει αποτύχει στο DC1 και ένας κόμβος έχει αποτύχει στο DC2.

**Ερωτήσεις:**   
a) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **LOCAL_QUORUM** σε έναν ενεργό κόμβο στο DC1;   
b) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **EACH_QUORUM** σε έναν ενεργό κόμβο στο DC2;   
c) Τι θα συμβεί αν γίνει ένα αίτημα ανάγνωσης με επίπεδο συνοχής **QUORUM** σε έναν ενεργό κόμβο στο DC1;   

---

**Λύση 5:**

**Αρχική Κατάσταση:**
*   DC1: 2 κόμβοι. RF = 2.
*   DC2: 2 κόμβοι. RF = 2.
*   Αποτυχίες: 1 κόμβος στο DC1, 1 κόμβος στο DC2.

**Ενεργοί Κόμβοι μετά τις αποτυχίες:**
*   DC1: 2 - 1 = 1 ενεργός κόμβος.
*   DC2: 2 - 1 = 1 ενεργός κόμβος.

**Απαντήσεις:**   
a) **LOCAL_QUORUM σε ενεργό κόμβο στο DC1:**   
    *   Απαιτείται: Πλειοψηφία των ρεπλικών στο τοπικό datacenter (RF DC1 = 2). Πλειοψηφία = (2 / 2) + 1 = 2 επιτυχείς απαντήσεις από το DC1.   
    *   Διαθέσιμοι: 1 ενεργός κόμβος στο DC1.   
    *   Αποτέλεσμα: **Αποτυχία**. Ο κόμβος του DC1 δεν μπορεί να ανταποκριθεί στην απαίτηση για 2 επιβεβαιώσεις (έχει μόνο 1 ενεργό κόμβο).   

b) **EACH_QUORUM σε ενεργό κόμβο στο DC2:**   
    *   Απαιτείται: Πλειοψηφία των ρεπλικών σε ΚΑΘΕ datacenter.   
        *   Για DC1 (RF=2): Πλειοψηφία = (2 / 2) + 1 = 2 επιτυχείς απαντήσεις. Διαθέσιμοι 1 κόμβος. **ΑΠΟΤΥΧΙΑ**.   
        *   Για DC2 (RF=2): Πλειοψηφία = (2 / 2) + 1 = 2 επιτυχείς απαντήσεις. Διαθέσιμοι 1 κόμβος. **ΑΠΟΤΥΧΙΑ**.   
    *   Αποτέλεσμα: **Αποτυχία**. Και τα δύο datacenters έχουν λιγότερους ενεργούς κόμβους από αυτούς που απαιτούνται για το τοπικό QUORUM.   

c) **QUORUM σε ενεργό κόμβο στο DC1:**   
    *   Απαιτείται: Πλειοψηφία του συνόλου των ρεπλικών του cluster. Το συνολικό RF για ένα δεδομένο είναι RF(DC1) + RF(DC2) = 2 + 2 = 4.   
    *   Πλειοψηφία = (4 / 2) + 1 = 3 επιτυχείς απαντήσεις.   
    *   Διαθέσιμοι: 1 (DC1) + 1 (DC2) = 2 ενεργοί κόμβοι συνολικά.   
    *   Αποτέλεσμα: **Αποτυχία**. Οι συνολικά ενεργοί κόμβοι (2) δεν είναι αρκετοί για να καλύψουν την απαίτηση των 3 επιτυχών απαντήσεων για το συνολικό QUORUM.   
