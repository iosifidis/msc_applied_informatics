# **Γεω-χωρικά Δεδομένα σε Συστήματα NoSQL**

## **1. Αναπαράσταση Γεω-χωρικών Δεδομένων σε NoSQL - GeoJSON (Διαφάνεια 2-4)**

*   **Τυπική Προσέγγιση:** Δεδομένου ότι πολλά NoSQL συστήματα (ιδιαίτερα Document Databases) βασίζονται σε formats όπως το JSON, η πιο κοινή προσέγγιση για την αναπαράσταση γεωμετριών είναι η χρήση του **GeoJSON format**.
*   **GeoJSON:** Είναι ένα τυπικό format ανοικτού κώδικα για την αναπαράσταση διαφόρων γεωγραφικών χαρακτηριστικών, συμπεριλαμβανομένης της γεωμετρίας, σε JSON.
*   **Υποστήριξη MongoDB (Παράδειγμα Document DB):** Το MongoDB υποστηρίζει την αποθήκευση GeoJSON δεδομένων χρησιμοποιώντας ένα **εμφωλευμένο (embedded) document** μέσα στο κύριο document.
    *   Αυτό το εμφωλευμένο document **πρέπει** να έχει δύο πεδία (ονόματα πεδίων που πρέπει να τηρούν συγκεκριμένο naming convention ή να ορίζονται σωστά):
        *   Ένα πεδίο ονόματι `type` που καθορίζει τον **τύπο GeoJSON αντικειμένου** (π.χ. "Point", "LineString", "Polygon").
        *   Ένα πεδίο ονόματι `coordinates` που καθορίζει τις **συντεταγμένες** του αντικειμένου σε μορφή array(s), σύμφωνα με τις προδιαγραφές του GeoJSON.
    *   **Παραδείγματα GeoJSON Objects σε MongoDB (Διαφάνεια 2):**
        *   Σημείο: `{ type: "Point", coordinates: [ 40, 5 ] }` (ένα array [longitude, latitude])
        *   Γραμμή: `{ type: "LineString", coordinates: [ [ 40, 5 ], [ 41, 6 ] ] }` (array από arrays σημείων)
        *   Πολύγωνο: `{ type: "Polygon", coordinates: [ [ [ 0 , 0 ] , [ 3 , 6 ] , [ 6 , 1 ] , [ 0 , 0 ] ] ]}` (array από arrays γραμμικών δακτυλίων, όπου ο εξωτερικός είναι το πρώτο στοιχείο).
*   **Υποστήριξη GeoJSON τύπων (Διαφάνεια 3):** Πολλά NoSQL συστήματα υποστηρίζουν τους επτά βασικούς τύπους γεωμετρίας Vector του OGC σε GeoJSON format: Point, LineString, Polygon, MultiPoint, MultiLineString, MultiPolygon, GeometryCollection.
*   **Legacy Coordinate Pairs (Διαφάνεια 4):** Εκτός από το GeoJSON format, ορισμένα NoSQL συστήματα (όπως το MongoDB) υποστηρίζουν και την αποθήκευση συντεταγμένων σε απλά array `[x, y]` ή `[longitude, latitude]` ή ακόμα και σε εμφωλευμένα documents με συγκεκριμένα ονόματα πεδίων (`{x: <x>, y: <y>}` ή `{longitude: <longitude>, latitude: <latitude>}`). Ωστόσο, το GeoJSON format είναι η **προτιμώμενη** και πιο τυποποιημένη μέθοδος.

## **2. Γεω-χωρικά Ευρετήρια σε NoSQL (Geospatial Indexes in NoSQL) (Διαφάνεια 5-6)**

Όπως και στις παραδοσιακές Spatial Databases, για την αποδοτική αναζήτηση γεω-χωρικών δεδομένων σε NoSQL, απαιτούνται εξειδικευμένα γεω-χωρικά ευρετήρια.

*   **2dsphere Indexes (MongoDB):** Αυτοί οι ευρετήρια υποστηρίζουν ερωτήματα που υπολογίζουν γεωμετρίες σε μια **γήινη σφαίρα (earth-like sphere)**. Είναι κατάλληλα για γεωγραφικές συντεταγμένες (γεωγραφικό πλάτος/μήκος).
    *   Δημιουργία: `db.collection.createIndex( { <location field> : "2dsphere" } )`. Το `<location field>` πρέπει να είναι το πεδίο που περιέχει το GeoJSON object ή ένα legacy coordinate pair.
*   **2d Indexes (MongoDB):** Αυτοί οι ευρετήρια υποστηρίζουν ερωτήματα που υπολογίζουν γεωμετρίες σε ένα **δισδιάστατο επίπεδο (two-dimensional plane)**. Είναι κατάλληλα για ευθείες γραμμές σε επίπεδο χώρο (π.χ. προβεβλημένα συστήματα συντεταγμένων, ή αν οι αποστάσεις/περιοχές είναι μικρές και η καμπυλότητα της Γης είναι αμελητέα).
    *   Δημιουργία: `db.collection.createIndex( { <location field> : "2d" } )`. Το `<location field>` πρέπει να είναι ένα legacy coordinate pair.
*   **Γεω-χωρικά Ευρετήρια και Sharding (Διαφάνεια 6):**
    *   Στο MongoDB, **δεν μπορείτε να χρησιμοποιήσετε ένα γεω-χωρικό ευρετήριο (2dsphere ή 2d) ως shard key** όταν κάνετε sharding μια συλλογή. Αυτό συμβαίνει λόγω των περιορισμών των αλγορίθμων διαμερισμού σε σχέση με τις χωρικές αναζητήσεις.
    *   Ωστόσο, **μπορείτε** να δημιουργήσετε ένα γεω-χωρικό ευρετήριο σε μια sharded collection, αλλά το **shard key πρέπει να είναι ένα διαφορετικό πεδίο** (ένα πεδίο που χρησιμοποιεί hash-based ή range-based sharding). Αυτό σημαίνει ότι γεω-χωρικά ερωτήματα σε μια sharded συλλογή **ίσως να πρέπει να "πάνε" σε όλα τα shards** για να βρουν τα αποτελέσματα, κάτι που μπορεί να είναι αναποτελεσματικό (π.χ. "βρες όλα τα σημεία κοντά σε Χ" μπορεί να ελεγχθούν όλα τα shards).

## **3. Γεω-χωρικές Λειτουργίες σε NoSQL (Geospatial Operations in NoSQL) (Διαφάνεια 7-8)**

Τα NoSQL συστήματα που υποστηρίζουν γεω-χωρικά δεδομένα παρέχουν και συναφείς λειτουργίες για αναζήτηση και ανάλυση.

*   **MongoDB (Παράδειγμα Document DB):**
    *   `$geoNear`: Ένα **aggregation stage** που υπολογίζει την απόσταση ενός σημείου αναφοράς από τα έγγραφα μιας συλλογής με γεω-χωρικά δεδομένα και επιτρέπει φιλτράρισμα βάσει απόστασης. Απαιτεί γεω-χωρικό ευρετήριο.
    *   `$near` και `$nearSphere`: Τελεστές αναζήτησης για εύρεση εγγράφων με γεωμετρίες **κοντά (near)** σε ένα σημείο αναφοράς. Ο `$nearSphere` κάνει υπολογισμούς σε σφαίρα (γήινη), ο `$near` σε επίπεδο χώρο.
    *   `$geoWithin`: Τελεστής αναζήτησης για εύρεση εγγράφων με γεωμετρίες **μέσα (within)** σε μια δεδομένη γεωμετρία (π.χ. ένα πολύγωνο).
    *   `$geoIntersects`: Τελεστής αναζήτησης για εύρεση εγγράφων με γεωμετρίες που **διασταυρώνονται (intersects)** με μια δεδομένη γεωμετρία.
*   **Neo4j (Παράδειγμα Graph DB) (Διαφάνεια 8):**
    *   Υποστηρίζει τύπους σημείων (Point) σε **2D και 3D Καρτεσιανές** συντεταγμένες και σε **2D και 3D γεωγραφικές (WGS 84)** συντεταγμένες.
    *   Παρέχει χωρικές συναρτήσεις για αυτά τα σημεία, όπως:
        *   `point.distance()`: Υπολογισμός απόστασης μεταξύ δύο σημείων.
        *   `point.withinBBox()`: Έλεγχος αν ένα σημείο βρίσκεται εντός ενός Bounding Box.
        *   Μπορείς να χρησιμοποιήσεις αυτά σε Cypher queries.

## **4. Πρόσθετη Ανάγνωση (Extra Reading) (Διαφάνεια 9)**

*   Η διαφάνεια αναφέρει ένα πρόσφατο άρθρο (2020) που ανασκοπεί την τρέχουσα κατάσταση της **επεξεργασίας γεω-χωρικών πληροφοριών σε NoSQL βάσεις δεδομένων**. Συνιστάται για όσους ενδιαφέρονται να εμβαθύνουν στο θέμα.

**Σύνδεση με το μάθημα:**

*   Τα γεω-χωρικά δεδομένα αποτελούν έναν σημαντικό τύπο "πολύπλοκων" δεδομένων, πέρα από τα απλά structured data, που συχνά βρίσκουμε σε Big Data workloads στο Cloud.
*   Είδαμε ότι τα RDBMS επεκτείνονται (π.χ. PostGIS) για να διαχειριστούν πλήρως τους χωρικούς τύπους, ευρετήρια και συναρτήσεις.
*   Τα NoSQL συστήματα, όπως το MongoDB (Document DB) και το Neo4j (Graph DB), υιοθετούν επίσης γεω-χωρικές δυνατότητες, συχνά βασιζόμενες στο GeoJSON format για την αναπαράσταση γεωμετρίας και προσφέροντας βασικά γεω-χωρικά ευρετήρια και συναρτήσεις/τελεστές.
*   **Προσοχή:** Οι γεω-χωρικές δυνατότητες στα NoSQL συνήθως **δεν είναι τόσο πλήρεις και ισχυρές** όσο σε εξειδικευμένες Spatial Databases όπως το PostGIS. Οι αναλύσεις και τα ερωτήματα που υποστηρίζονται είναι συχνά πιο περιορισμένα.
*   Η επιλογή του συστήματος εξαρτάται από τις ανάγκες: αν η γεω-χωρική ανάλυση είναι κεντρική και σύνθετη, μια Spatial Database (RDBMS με χωρική επέκταση) μπορεί να είναι καταλληλότερη. Αν η γεω-χωρική πληροφορία είναι ένα από πολλά χαρακτηριστικά των δεδομένων και τα κύρια ζητήματα είναι κλιμακούμενοτητα/ευελιξία/διαθεσιμότητα (που προσφέρουν τα NoSQL), τότε οι γεω-χωρικές δυνατότητες του NoSQL συστήματος μπορεί να είναι επαρκείς.
