# 🗂 ΕΙΣΑΓΩΓΗ ΣΤΙΣ DOCUMENT DATABASES

**1. Εισαγωγή & Βάσεις Δεδομένων Εγγράφων (Document Databases)**

*   **MongoDB:** Μια δημοφιλής βάση δεδομένων NoSQL.
*   **Βάσεις Δεδομένων Εγγράφων:**
    *   Είναι **μη σχεσιακές** βάσεις δεδομένων (NoSQL).
    *   Αποθηκεύουν δεδομένα με τη μορφή **δομημένων εγγράφων** (structured documents).
    *   Κοινά format εγγράφων: **XML** και **JSON**.
    *   **Αυτο-περιγραφόμενα δεδομένα:** Η δομή (schema) περιγράφεται μέσα στο ίδιο το έγγραφο.
    *   Κατάλληλες για **αντικειμενοστραφή / web προγραμματισμό**.
    *   **Ευέλικτη τυποποίηση (Flexible typing):** Τα έγγραφα στην ίδια συλλογή δεν χρειάζεται να έχουν ακριβώς την ίδια δομή.
*   **Χρήσεις:**
    *   **XML:** Συχνά σε συστήματα διαχείρισης περιεχομένου (CMS), αρχεία κειμένου.
    *   **JSON:** Κυρίως σε web-based λειτουργικά φορτία (operational workloads).

**2. JSON (JavaScript Object Notation)**

*   **Ορισμός:** Ένα **ελαφρύ format ανταλλαγής δεδομένων**.
*   **Χαρακτηριστικά:**
    *   Εύκολο στην ανάγνωση/γραφή από ανθρώπους.
    *   Εύκολο στην ανάλυση (parse) και παραγωγή (generate) από μηχανές.
    *   Βασίζεται σε ένα υποσύνολο της JavaScript.
    *   **Ανεξάρτητο γλώσσας προγραμματισμού**, αλλά χρησιμοποιεί συμβάσεις γνωστές σε πολλές γλώσσες (C-οικογένεια: C, C++, C#, Java, Python κ.λπ.).
*   **Δομές JSON:**
    *   **Συλλογή από ζεύγη όνομα/τιμή (name/value pairs):** Υλοποιείται ως *object*, record, struct, dictionary, hash table, associative array σε διάφορες γλώσσες.
    *   **Ταξινομημένη λίστα τιμών (ordered list of values):** Υλοποιείται ως *array*, vector, list, sequence.
*   **JSON vs XML (Διαφ. 4):** Το JSON είναι συνήθως πιο συμπαγές και λιγότερο φλύαρο από το XML για την αναπαράσταση παρόμοιων δομών δεδομένων.

**3. Βασικές Έννοιες Βάσεων Δεδομένων Εγγράφων (MongoDB)**

*   **Συλλογή (Collection):** Μια ομάδα από έγγραφα. Αντίστοιχο του *Πίνακα* (Table) στις σχεσιακές βάσεις.
*   **Έγγραφο (Document):** Η βασική μονάδα αποθήκευσης. Αντίστοιχο της *Γραμμής* (Row) στις σχεσιακές βάσεις.
    *   Αποτελείται από ζεύγη **κλειδί-τιμή (key-value pairs)**.
    *   Τα κλειδιά επιτρέπουν την πρόσβαση στις τιμές τους.
    *   **Ευελιξία σχήματος (Schema Flexibility):** Δεν υπάρχει αυστηρό, προκαθορισμένο σχήμα για όλα τα έγγραφα σε μια συλλογή. Κάθε έγγραφο μπορεί να έχει διαφορετικά πεδία.
    *   Μπορεί να περιέχει σύνθετες δομές: πεδία, πίνακες (arrays), ή και **ένθετα έγγραφα (nested documents)**.
*   **Παραδείγματα:** MongoDB, CouchDB.

**4. Σύγκριση: RDBMS vs Document DB (MongoDB)**

| Σχεσιακό Μοντέλο (RDBMS) | Μοντέλο Εγγράφων (MongoDB) |
| :------------------------ | :------------------------- |
| Πίνακες (Tables)          | Συλλογές (Collections)     |
| Γραμμές (Rows)            | Έγγραφα (Documents)        |
| Στήλες (Columns)          | Πεδία (Fields)/Κλειδί-Τιμή |
| Joins (Συνδέσεις)         | Συνήθως όχι άμεσα\*       |

*\* Οι συνδέσεις (joins) γίνονται συχνά μέσω μοντελοποίησης (embedding) ή στην πλευρά της εφαρμογής (application-side joins).*

**5. Τεχνικές Μοντελοποίησης Δεδομένων σε NoSQL/MongoDB**

*   **Κίνητρο:** Η μοντελοποίηση συχνά καθοδηγείται από τα **ερωτήματα της εφαρμογής (application queries)** ("What are my queries like?") σε αντίθεση με τις RDBMS που καθοδηγούνται από τη δομή των δεδομένων ("What are my data like?").
*   **Βασικές Τεχνικές:**
    *   **Αποκανονικοποίηση (Denormalization):**
        *   Αντιγραφή (replication) των ίδιων δεδομένων σε πολλαπλά έγγραφα/συλλογές.
        *   **Σκοπός:** Απλοποίηση/βελτιστοποίηση της επεξεργασίας ερωτημάτων (μείωση ανάγκης για joins).
        *   **Ανταλλάγματα:** Μειώνει τον όγκο δεδομένων/IO *ανά ερώτημα* ή την πολυπλοκότητα επεξεργασίας, αλλά αυξάνει τον *συνολικό* όγκο δεδομένων και την πολυπλοκότητα των ενημερώσεων (updates).
    *   **Συναθροίσεις / Ενσωμάτωση (Aggregation / Embedding):**
        *   Δημιουργία εγγράφων με πολύπλοκη εσωτερική δομή (π.χ., ένθετες οντότητες/έγγραφα).
        *   Επιτρέπει διαφορές στη δομή μεταξύ εγγράφων στην ίδια συλλογή.
        *   **Μειώνει την ανάγκη για joins** ενσωματώνοντας σχετιζόμενα δεδομένα (ιδίως για σχέσεις ένα-προς-πολλά).
        *   Καλύπτει διαφορές μεταξύ ομοειδών ή ετερογενών οντοτήτων χρησιμοποιώντας μια κοινή συλλογή.
    *   **Συνδέσεις από την Πλευρά της Εφαρμογής (Application Side Joins):**
        *   Η λογική της "σύνδεσης" δεδομένων από διαφορετικές συλλογές υλοποιείται στον κώδικα της εφαρμογής, κάνοντας πολλαπλά ερωτήματα στη βάση. Χρησιμοποιείται όταν η ενσωμάτωση (embedding) δεν είναι κατάλληλη (π.χ., σχέσεις πολλά-προς-πολλά, δεδομένα που δεν προσπελαύνονται συχνά μαζί).
    *   **Σύνδεση Εγγράφων (Document Linking):**
        *   Αντί να ενσωματώνεται ολόκληρο το σχετιζόμενο έγγραφο, αποθηκεύεται μόνο μια αναφορά (συνήθως το `_id` του) στο άλλο έγγραφο. Απαιτεί ένα δεύτερο ερώτημα για την ανάκτηση των συνδεδεμένων δεδομένων (παρόμοιο με application-side join).

*   **Ιεραρχικά/Γραφο-δομημένα Δεδομένα:** Οι σχεσιακές βάσεις συχνά δεν είναι ιδανικές για αυτά τα είδη δεδομένων, όπου οι Document DBs υπερτερούν.

**6. Ειδικά για το MongoDB**

*   **Προέλευση:** Αναπτύχθηκε από την 10gen (τώρα MongoDB, Inc.) το 2007. Προέρχεται από τη λέξη "humongous".
*   **Χαρακτηριστικά:**
    *   Open Source (Ανοιχτού Κώδικα).
    *   **Document-oriented (Εγγράφο-στραφής).**
    *   **Schema-less:** Δεν απαιτείται αυστηρό schema (αν και συνήθως υπάρχει ένα implicit schema στην εφαρμογή).
    *   Hash-based.
    *   Δεν υπάρχει Data Definition Language (DDL) όπως στην SQL.
    *   Χρησιμοποιεί **BSON (Binary JSON)** για αποθήκευση (βελτιστοποιημένη δυαδική μορφή του JSON).
    *   Κάθε έγγραφο έχει ένα αυτόματα παραγόμενο (εκτός αν δοθεί) μοναδικό αναγνωριστικό **`_id`**.
    *   Γραμμένο σε C++.
    *   Διαθέτει APIs για πολλές γλώσσες προγραμματισμού.
*   **Γιατί MongoDB;**
    *   Απλά ερωτήματα (queries).
    *   Κατάλληλο για τις περισσότερες web εφαρμογές.
    *   Ευκολότερη και ταχύτερη ενσωμάτωση δεδομένων (data integration).
    *   **Προσοχή:** Όχι τόσο κατάλληλο για συστήματα με βαριές, πολύπλοκες συναλλαγές (transactions) που απαιτούν ACID ιδιότητες σε πολλαπλά έγγραφα με τον κλασικό τρόπο των RDBMS.
*   **Βασική Ορολογία (Επανάληψη & Προσθήκες):**
    *   **Database:** Ένα σύνολο από συλλογές.
    *   **Collection:** Ένα σύνολο από έγγραφα.
    *   **Document:** Ένα σύνολο από πεδία (key-value pairs).
    *   **Field:** Ένα ζεύγος κλειδί-τιμή μέσα σε ένα έγγραφο.
    *   **Index (Ευρετήριο):** Δομές δεδομένων (B+ Tree στο MongoDB) που βελτιώνουν την ταχύτητα των ερωτημάτων. Δημιουργείται αυτόματα στο `_id`. Μπορούν να είναι σε ένα πεδίο (single field) ή συνδυασμό πεδίων (compound).
    *   **Cursor (Δρομέας):** Το αποτέλεσμα ενός `find` query. Είναι ένας δείκτης στο σύνολο αποτελεσμάτων, που επιτρέπει ενέργειες όπως καταμέτρηση, παράλειψη (skip), ή τμηματική ανάκτηση δεδομένων.

**7. Αρχιτεκτονική MongoDB**

*   **mongod:** Η κύρια διεργασία της βάσης δεδομένων (database instance). Διαχειρίζεται τα δεδομένα, τα indexes και απαντά στα queries.
*   **mongos:** Η διεργασία δρομολόγησης (router/sharding process). Χρησιμοποιείται σε sharded clusters. Δέχεται τα queries από την εφαρμογή, συμβουλεύεται τους config servers για το πού βρίσκονται τα δεδομένα, προωθεί τα queries στα κατάλληλα shards (mongod instances), και συλλέγει/συγχωνεύει τα αποτελέσματα.
*   **Config Server:** Αποθηκεύει τα metadata του cluster (πληροφορίες για τα shards, chunks κ.λπ.). Απαραίτητο για sharding.
*   **Mongo Shell (`mongo`):** Ένα διαδραστικό περιβάλλον JavaScript για τη διαχείριση και εκτέλεση ερωτημάτων στη MongoDB.

**8. Sharding (Διαμοιρασμός)**

*   **Σκοπός:** Οριζόντια κλιμάκωση (horizontal scaling) για διαχείριση μεγάλου όγκου δεδομένων και φορτίου.
*   **Shard Key:** Ένα ή περισσότερα *ευρετηριασμένα* πεδία που καθορίζουν πώς θα διανεμηθούν τα δεδομένα στα shards.
*   **Τύποι Sharding:** Range-based (βάσει εύρους τιμών) ή Hash-based (βάσει hash του κλειδιού).
*   **Cluster Balancing:** Η διαδικασία που εξασφαλίζει ομοιόμορφη κατανομή των δεδομένων. Γίνεται με μετακίνηση "chunks".
*   **Chunk:** Μια λογική ενότητα δεδομένων (default 64MB) που μπορεί να μετακινηθεί μεταξύ των shards για εξισορρόπηση.

**9. Replication (Αναπαραγωγή)**

*   **Σκοπός:** Υψηλή διαθεσιμότητα (High Availability) και δυνατότητα κλιμάκωσης των αναγνώσεων (read scalability).
*   **Replica Set:** Ένα σύνολο από κόμβους (mongod instances) που περιέχουν τα ίδια δεδομένα.
    *   **Primary Node:** Ένας κόμβος που δέχεται όλες τις εγγραφές (writes).
    *   **Secondary Nodes:** Ένας ή περισσότεροι κόμβοι που αντιγράφουν τα δεδομένα από τον primary (ασύγχρονα). Μπορούν να εξυπηρετήσουν αναγνώσεις (reads).
    *   **Επιλογή Primary:** Γίνεται μέσω ψηφοφορίας (voting) μεταξύ των μελών.
    *   **Oplog (Operations Log):** Μια ειδική capped collection στον primary που καταγράφει όλες τις αλλαγές. Οι secondaries παρακολουθούν το oplog για να συγχρονιστούν.
    *   **Heartbeats:** Μηνύματα επικοινωνίας μεταξύ των μελών του replica set.

**10. Write/Read Operations**

*   **Write Concern:** Καθορίζει πότε μια εγγραφή θεωρείται επιτυχής (π.χ., όταν επιβεβαιωθεί από τον primary, ή από έναν αριθμό μελών του replica set). Μπορεί να επηρεάσει την απόδοση (blocking calls).
*   **Read Preference:** Καθορίζει από ποιους κόμβους (primary ή secondaries) θα εξυπηρετηθούν οι αναγνώσεις. Το default είναι από τον **primary**.
*   **Consistency (Συνέπεια):** By default, η MongoDB προσφέρει **strict consistency** όταν οι αναγνώσεις γίνονται από τον primary.
*   **Locking (Κλείδωμα):** Η MongoDB χρησιμοποιεί κλείδωμα σε επίπεδο **εγγράφου (document-level)** για τις περισσότερες λειτουργίες, επιτρέποντας υψηλή ταυτόχρονη πρόσβαση.

**11. Βασικές Εντολές Mongo Shell**

*   `show dbs`: Εμφανίζει όλες τις βάσεις δεδομένων στον server.
*   `use <dbname>`: Επιλέγει την τρέχουσα βάση δεδομένων. Αν δεν υπάρχει, δημιουργείται με την πρώτη εισαγωγή δεδομένων.
*   `show collections`: Εμφανίζει τις συλλογές στην τρέχουσα βάση δεδομένων.

**12. CRUD Operations (Create, Read, Update, Delete)**

*   **Create:**
    *   `db.collection.insertOne(document)`: Εισάγει ένα έγγραφο.
    *   `db.collection.insertMany([doc1, doc2,...])`: Εισάγει πολλά έγγραφα.
    *   Αν το `_id` παραληφθεί, η MongoDB το δημιουργεί αυτόματα.
*   **Read:**
    *   `db.collection.find(query, projection)`: Βρίσκει έγγραφα που ταιριάζουν στο `query`. Το `projection` καθορίζει ποια πεδία θα επιστραφούν. Επιστρέφει έναν cursor.
    *   `db.collection.findOne(query, projection)`: Επιστρέφει το πρώτο έγγραφο που ταιριάζει.
    *   Το `query` είναι ένα JSON object (π.χ., `{ status: "A" }`). Μοιάζει με το "WHERE" της SQL.
    *   Υποστηρίζει ταξινόμηση (`sort`), παράλειψη (`skip`), όριο (`limit`).
*   **Update:**
    *   `db.collection.updateOne(query, update, options)`: Ενημερώνει το πρώτο έγγραφο που ταιριάζει στο `query`.
    *   `db.collection.updateMany(query, update, options)`: Ενημερώνει όλα τα έγγραφα που ταιριάζουν στο `query`.
    *   Το `update` χρησιμοποιεί update operators (π.χ., `$set`, `$inc`, `$push`).
    *   `options`: π.χ., `{ upsert: true }` (αν δεν βρεθεί έγγραφο, εισάγει ένα νέο).
*   **Delete:**
    *   `db.collection.deleteOne(query)`: Διαγράφει το πρώτο έγγραφο που ταιριάζει.
    *   `db.collection.deleteMany(query)`: Διαγράφει όλα τα έγγραφα που ταιριάζουν.
    *   `db.collection.drop()`: Διαγράφει ολόκληρη τη συλλογή.

**13. Query Operators (Τελεστές Ερωτημάτων)**

*   **Comparison (Σύγκρισης):** `$eq` (equal), `$gt` (greater than), `$gte` (greater than or equal), `$lt` (less than), `$lte` (less than or equal), `$ne` (not equal), `$in` (exists in array), `$nin` (not in array).
*   **Logical (Λογικοί):** `$and`, `$or`, `$not`, `$nor`.
*   **Element:** `$exists` (αν ένα πεδίο υπάρχει).
*   **(Άλλοι τελεστές για Update, Aggregation κ.λπ.)**

**14. Aggregation Framework (Πλαίσιο Συναθροίσεων)**

*   Παρέχει λειτουργικότητα παρόμοια με το `GROUP BY` και τις aggregate functions της SQL.
*   Λειτουργεί ως **pipeline (αγωγός):** Τα έγγραφα περνούν διαδοχικά από στάδια (stages).
*   Κάθε στάδιο μετασχηματίζει τα έγγραφα.
*   **Κοινά Στάδια (Stages):**
    *   `$match`: Φιλτράρει έγγραφα (σαν το `find` query ή το `WHERE`/`HAVING`).
    *   `$project`: Επιλέγει, μετονομάζει, προσθέτει ή αφαιρεί πεδία.
    *   `$group`: Ομαδοποιεί έγγραφα βάσει ενός κλειδιού (`_id`) και εφαρμόζει aggregate functions (accumulators).
    *   `$sort`: Ταξινομεί τα έγγραφα.
    *   `$limit`: Περιορίζει τον αριθμό των εγγράφων.
    *   `$skip`: Παραλείπει έγγραφα.
    *   `$unwind`: "Ξετυλίγει" ένα πεδίο τύπου array, δημιουργώντας ένα έγγραφο για κάθε στοιχείο του array.
*   **Accumulators (μέσα στο `$group`):** `$sum`, `$avg`, `$min`, `$max`, `$push` (δημιουργεί array τιμών), `$addToSet` (δημιουργεί array μοναδικών τιμών), `$count`.

**15. Περισσότερα για τα Queries**

*   **Dot Notation:** Επιτρέπει την πρόσβαση σε πεδία μέσα σε ένθετα έγγραφα ή σε στοιχεία πινάκων (π.χ., `"address.city": "New York"`).
*   **Matching Embedded Objects:** Μπορεί να γίνει ακριβής αντιστοίχιση ολόκληρου του ένθετου εγγράφου.
*   **Cursors:** Η επανάληψη πάνω στα αποτελέσματα ενός `find` γίνεται με μεθόδους του cursor όπως `hasNext()` και `next()`.

**16. Περιορισμοί του MongoDB**

*   **No Referential Integrity:** Δεν υπάρχει ενσωματωμένη υποστήριξη για foreign keys και αυτόματη διασφάλιση της ακεραιότητας αναφορών όπως στις RDBMS. Αυτό πρέπει να διαχειρίζεται η εφαρμογή.
*   **Denormalization Update Costs:** Η αποκανονικοποίηση απλοποιεί τις αναγνώσεις αλλά μπορεί να κάνει τις ενημερώσεις πολύπλοκες και δαπανηρές, καθώς τα ίδια δεδομένα μπορεί να χρειάζεται να ενημερωθούν σε πολλά μέρη.
*   **Schema Flexibility Challenges:** Αν και η ευελιξία είναι πλεονέκτημα, η έλλειψη επιβεβλημένου σχήματος μπορεί να οδηγήσει σε ασυνέπεια δεδομένων (inconsistency) μέσα στην ίδια συλλογή αν δεν διαχειριστεί σωστά από την εφαρμογή. Η εφαρμογή σχεδόν πάντα *χρειάζεται* να γνωρίζει κάποια δομή για να λειτουργήσει.
