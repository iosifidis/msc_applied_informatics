### **Σημειώσεις για το Μάθημα "Συστήματα Ροών"**

#### Εισαγωγή
Στο μάθημα αυτό θα μελετήσουμε τα **Συστήματα Ροών**, τα οποία είναι κρίσιμα για την επεξεργασία δεδομένων σε πραγματικό χρόνο. Τα συστήματα αυτά χρησιμοποιούνται για τη διαχείριση συνεχών ροών δεδομένων και την εκτέλεση συνεχών ερωτημάτων, χωρίς την ανάγκη αποθήκευσης των δεδομένων πριν την επεξεργασία τους.

---

### Βασικές Έννοιες

1. **Συστήματα Επεξεργασίας Ροών (DSMS)**:
   - Ένα DSMS (Data Stream Management System) είναι σχεδιασμένο να χειρίζεται ροές δεδομένων και να εκτελεί συνεχή ερωτήματα.
   - Τα ερωτήματα εκτελούνται συνεχώς μέχρι να απενεργοποιηθούν ρητά.
   - Τα δεδομένα επεξεργάζονται καθώς φτάνουν, χωρίς να χρειάζεται να αποθηκευτούν πρώτα.
   - Η επεξεργασία γίνεται σε **πραγματικό χρόνο**, με αυστηρές προθεσμίες.

2. **Διαφορές με Συστήματα Επεξεργασίας Κατά Παρτίδες**:
   - Τα συστήματα ροών επεξεργάζονται δεδομένα σε πραγματικό χρόνο, ενώ τα συστήματα παρτίδων επεξεργάζονται δεδομένα σε ομαδοποιημένα σύνολα (batches).
   - Τα συστήματα ροών απαιτούν χαμηλή καθυστέρηση και ανταπόκριση εντός προθεσμιών.

---

### Μοντέλα Επεξεργασίας Ροών

1. **Stream-Dataflow**:
   - Τα δεδομένα αντιμετωπίζονται ως μια συνεχής ροή γεγονότων.
   - Κάθε εργασία περιλαμβάνει τελεστές όπως φίλτρα, παράθυρα, συναθροίσεις ή συναρτήσεις που ορίζονται από τον χρήστη.
   - Τα δεδομένα παραδίδονται και καταναλώνονται με αυθαίρετη σειρά σε παράλληλες εργασίες.

2. **Μικροπαρτίδες (Micro-batches)**:
   - Επιτρέπουν την επεξεργασία ροών σε συστήματα που βασίζονται σε παρτίδες.
   - Η ροή διακριτοποιείται σε μικρές παρτίδες, οι οποίες επεξεργάζονται ως ακολουθία μετασχηματισμών.

---

### Εγγυήσεις Παράδοσης

1. **Το πολύ μία φορά (At-most-once)**:
   - Κάθε μήνυμα παραδίδεται μία φορά ή καθόλου.
   - Τα μηνύματα μπορεί να χαθούν, αλλά η απόδοση είναι υψηλή.

2. **Τουλάχιστον μία φορά (At-least-once)**:
   - Κάθε μήνυμα παραδίδεται τουλάχιστον μία φορά, με δυνατότητα διπλής παράδοσης.
   - Απαιτεί επαναλήψεις και διατήρηση κατάστασης για την αντιμετώπιση απωλειών.

3. **Ακριβώς μία φορά (Exactly-once)**:
   - Κάθε μήνυμα παραδίδεται ακριβώς μία φορά, χωρίς απώλειες ή διπλές παραδόσεις.
   - Αυτή η εγγύηση είναι η πιο ακριβή και έχει τη χειρότερη απόδοση.

---

### Εργαλεία Επεξεργασίας Ροών

1. **Apache Flink**:
   - Υποστηρίζει το μοντέλο Stream-Dataflow.
   - Εκτελεί προγράμματα ροής δεδομένων με χαμηλή καθυστέρηση και υψηλή απόδοση.
   - Υποστηρίζει παράδοση **ακριβώς μία φορά**.

2. **Apache Samza**:
   - Επεξεργάζεται μηνύματα ένα-ένα και συνεργάζεται με Apache Kafka για την αποθήκευση κατάστασης.
   - Υποστηρίζει παράδοση **τουλάχιστον μία φορά**.

3. **Apache Storm**:
   - Υλοποιεί το μοντέλο Stream-Dataflow με χαμηλή καθυστέρηση (κάτω του δευτερολέπτου).
   - Υποστηρίζει παράδοση **τουλάχιστον μία φορά**, αλλά δεν παρέχει ανάκτηση κατάστασης.

4. **Apache Spark Structured Streaming**:
   - Βασίζεται στη μηχανή Spark SQL και επιτρέπει την επεξεργασία ροών με τον ίδιο τρόπο όπως στατικά δεδομένα.
   - Υποστηρίζει παράδοση **ακριβώς μία φορά** μέσω σημείων ελέγχου και καταγραφής εγγραφών.

---

### Σύγκριση Συστημάτων Ροών

| Πλατφόρμα       | Επεξεργασία | Ροή               | Καθυστέρηση | Απόδοση | Εγγύηση Παράδοσης | Γλώσσες API       |
|------------------|-------------|-------------------|-------------|----------|-------------------|-------------------|
| Apache Storm     | Streaming   | Πλειάδες         | <1 δευτ.    | Χαμηλή   | Τουλάχιστον μία   | Οποιεσδήποτε      |
| Apache Spark     | Hybrid      | DataStream        | <1 δευτ.    | Υψηλή    | Ακριβώς μία       | Java, Scala, Python, R |
| Apache Samza     | Streaming   | Μηνύματα         | <1 δευτ.    | Υψηλή    | Τουλάχιστον μία   | Γλώσσες JVM       |
| Apache Flink     | Hybrid      | DataStream        | <1 δευτ.    | Υψηλή    | Ακριβώς μία       | Java, Scala, Python |

---

### Παράδειγμα Εφαρμογής: Streaming WordCount

1. **Σκοπός**:
   - Να μετρήσουμε τις λέξεις που λαμβάνονται από μια ροή δεδομένων μέσω socket.

2. **Βήματα**:
   - Δημιουργούμε ένα `DataFrame` που αντιπροσωπεύει την ροή δεδομένων από ένα socket.
   - Χρησιμοποιούμε συναρτήσεις όπως `split` και `explode` για να διαχωρίσουμε τις λέξεις.
   - Ομαδοποιούμε τις λέξεις και μετράμε τις εμφανίσεις τους.
   - Εκτυπώνουμε τα αποτελέσματα στην κονσόλα.

3. **Κώδικας**:
   ```python
   from pyspark.sql import SparkSession
   from pyspark.sql.functions import explode, split

   spark = SparkSession.builder.appName("StructuredNetworkWordCount").getOrCreate()

   lines = spark.readStream.format("socket").option("host", "localhost").option("port", 9999).load()
   words = lines.select(explode(split(lines.value, " ")).alias("word"))
   wordCounts = words.groupBy("word").count()

   query = wordCounts.writeStream.outputMode("complete").format("console").start()
   query.awaitTermination()
   ```

---

### Προγραμματιστικό Μοντέλο

1. **Ροή Δεδομένων ως Πίνακας**:
   - Μια ροή δεδομένων αντιμετωπίζεται ως ένας απεριόριστος πίνακας στον οποίο προσαρτώνται συνεχώς νέες σειρές.
   - Κάθε νέο δεδομένο που φτάνει είναι μια νέα σειρά στον πίνακα.

2. **Επαυξητική Επεξεργασία**:
   - Το Spark εκτελεί επαυξητικά ερωτήματα, ενημερώνοντας τον πίνακα αποτελεσμάτων κάθε φορά που φτάνουν νέα δεδομένα.

3. **Είδη Εξόδου**:
   - **Ολοκληρωμένη Λειτουργία (Complete Mode)**: Εμφανίζει ολόκληρο τον πίνακα αποτελεσμάτων.
   - **Λειτουργία Προσάρτησης (Append Mode)**: Εμφανίζει μόνο τις νέες σειρές που προστέθηκαν.
   - **Λειτουργία Ενημέρωσης (Update Mode)**: Εμφανίζει μόνο τις σειρές που ενημερώθηκαν.

---

### Συμπεράσματα
Τα συστήματα ροών είναι απαραίτητα για εφαρμογές που απαιτούν επεξεργασία δεδομένων σε πραγματικό χρόνο. Η επιλογή του κατάλληλου εργαλείου εξαρτάται από τις απαιτήσεις της εφαρμογής, όπως η καθυστέρηση, η απόδοση και οι εγγυήσεις παράδοσης.

---

## Εντολές

Αυτές είναι οι [εντολές](commands.md) του μαθήματος.
